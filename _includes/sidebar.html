<!-- _includes/sidebar.html -->
<nav id="site-sidebar" class="sidebar" aria-label="Sidebar navigation">
  <div class="sidebar-inner">
    <!-- Mobile close button - visible only when sidebar is open -->
    <button id="sidebar-close" class="sidebar-close" aria-label="Close navigation menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="sr-only">Close</span>
    </button>

    <!-- Theme toggle button -->
    <div class="sidebar-header">
      <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark/light theme" title="Toggle theme" onclick="ToggleTheme()">
        <svg class="theme-icon theme-icon-light" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
          <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>
        </svg>
        <svg class="theme-icon theme-icon-dark" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2"/>
        </svg>
        <span class="theme-label">Theme</span>
      </button>
    </div>

    <ul id="sidebar-list" class="sidebar-list">
      {% assign nav = site.data.navigation %}
      {% for section in nav %}
        <li class="sidebar-section">
          <button class="section-toggle" aria-expanded="false">{{ section.title }}</button>
          {% if section.items %}
            <ul class="section-items">
              {% for item in section.items %}
                {% if item.items %}
                  <!-- nested group -->
                  <li class="nav-group">
                    <button class="group-toggle" aria-expanded="false">{{ item.title }}</button>
                    <ul class="group-items">
                      {% for sub in item.items %}
                        <li class="nav-item {% if page.url == sub.url or page.url == sub.url | append: 'index.html' %}active{% endif %}">
                          <a href="{{ sub.url }}">{{ sub.title }}</a>
                        </li>
                      {% endfor %}
                    </ul>
                  </li>
                {% else %}
                  <li class="nav-item {% if page.url == item.url or page.url == item.url | append: 'index.html' %} active{% elsif page.url contains item.url and item.url != '/' %} active-parent{% endif %}">
                    <a href="{{ item.url }}">{{ item.title }}</a>
                  </li>
                {% endif %}
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</nav>
